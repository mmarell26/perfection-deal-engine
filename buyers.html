<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Buyer Intake • Perfection Deal Engine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
  <body>
  <script>
    (function () {
      // pages that don't require login
      const publicPages = ['login.html'];
      let path = window.location.pathname.split('/').pop();
      if (path === '' || path === '/') path = 'index.html';

      const isPublic = publicPages.includes(path);
      const loggedIn = localStorage.getItem('priLoggedIn') === 'true';

      if (!isPublic && !loggedIn) {
        window.location.href = 'login.html';
      }
    })();
  </script>
  <!-- existing topbar/header code comes AFTER this -->
  <header class="topbar">
    <div class="brand">
      <div class="brand-logo">PRI</div>
      <div class="brand-text">
        <span>Perfection REI</span>
        <span>Buyers</span>
      </div>
    </div>
    <nav class="nav-links">
      <a href="index.html">Dashboard</a>
      <a href="sellers.html">Sellers</a>
      <a href="buyers.html" class="active">Buyers</a>
      <a href="analyzer.html">Analyzer</a>
      <a href="loi.html">LOI</a>
      <a href="instagram.html">Instagram</a>
    </nav>
  </header>

  <main>
    <section class="card">
      <h1>Buyer Intake</h1>
      <p class="sub">
        Lock in serious buyers with tight criteria, so you always know who to blast a deal to.
      </p>

      <form id="buyer-form">
        <div class="row">
          <div>
            <label>Buyer Name / Company</label>
            <input id="buyer-name" required />
          </div>
          <div>
            <label>Phone</label>
            <input id="buyer-phone" />
          </div>
          <div>
            <label>Email</label>
            <input id="buyer-email" type="email" required />
          </div>
        </div>

        <div class="row">
          <div>
            <label>Target Areas / Zip Codes</label>
            <input id="buyer-areas" placeholder="North Philly, 19140, 19132" />
          </div>
          <div>
            <label>Property Types</label>
            <input id="buyer-types" placeholder="2–4 units, 5–20 units, mixed-use" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>Min Units</label>
            <input id="buyer-min-units" type="number" />
          </div>
          <div>
            <label>Max Units</label>
            <input id="buyer-max-units" type="number" />
          </div>
          <div>
            <label>Max Purchase Price ($)</label>
            <input id="buyer-max-price" type="number" />
          </div>
        </div>

        <div>
          <label>Notes</label>
          <textarea id="buyer-notes"
            placeholder="Cash / hard money, proof of funds, typical close time, etc."></textarea>
        </div>

        <div class="row mt-2">
          <button type="submit" class="btn btn-primary">Save Buyer</button>
          <button type="button" class="btn btn-ghost" id="export-buyers">Export (JSON)</button>
        </div>
      </form>
    </section>

    <section class="card">
      <span class="badge">Saved Buyers</span>
      <div id="buyer-list" class="list mt-1"></div>
      <p class="muted mt-1">
        Stored as <strong>perfection_buyers</strong> in your browser. Export and upload to Sheets/CRM when needed.
      </p>
    </section>
  </main>

  <script>
    const BUYER_KEY = "perfection_buyers";

    function loadBuyers() {
      const raw = localStorage.getItem(BUYER_KEY);
      return raw ? JSON.parse(raw) : [];
    }

    function saveBuyers(list) {
      localStorage.setItem(BUYER_KEY, JSON.stringify(list));
    }

    function renderBuyers() {
      const list = loadBuyers();
      const container = document.getElementById("buyer-list");
      container.innerHTML = "";

      if (!list.length) {
        container.innerHTML = '<p class="muted mt-1">No buyers saved yet.</p>';
        return;
      }

      list
        .slice()
        .reverse()
        .forEach((b) => {
          const div = document.createElement("div");
          div.className = "list-item";
          div.innerHTML = `
            <strong>${b.name || "Unknown buyer"}</strong>
            <span>${b.phone || ""} ${b.email ? " • " + b.email : ""}</span>
            <span>Areas: ${b.areas || "N/A"}</span>
            <span>Types: ${b.types || "N/A"}</span>
            <span>Units: ${b.minUnits || "?"}–${b.maxUnits || "?"} • Max: ${b.maxPrice || "?"}</span>
            <span>${b.notes ? "Notes: " + b.notes : ""}</span>
            <span>Saved: ${b.savedAt}</span>
          `;
          container.appendChild(div);
        });
    }

    document.getElementById("buyer-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const buyer = {
        name: document.getElementById("buyer-name").value.trim(),
        phone: document.getElementById("buyer-phone").value.trim(),
        email: document.getElementById("buyer-email").value.trim(),
        areas: document.getElementById("buyer-areas").value.trim(),
        types: document.getElementById("buyer-types").value.trim(),
        minUnits: document.getElementById("buyer-min-units").value.trim(),
        maxUnits: document.getElementById("buyer-max-units").value.trim(),
        maxPrice: document.getElementById("buyer-max-price").value.trim(),
        notes: document.getElementById("buyer-notes").value.trim(),
        savedAt: new Date().toLocaleString(),
      };

      const buyers = loadBuyers();
      buyers.push(buyer);
      saveBuyers(buyers);
      renderBuyers();
      e.target.reset();
      alert("Buyer saved.");
    });

    document.getElementById("export-buyers").addEventListener("click", () => {
      const buyers = loadBuyers();
      const blob = new Blob([JSON.stringify(buyers, null, 2)], {
        type: "application/json",
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "perfection-buyers.json";
      a.click();
      URL.revokeObjectURL(url);
    });

    renderBuyers();
  </script>
</body>
</html>
